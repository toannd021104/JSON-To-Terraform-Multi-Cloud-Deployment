{
  "groups": [
    "devops",
    "monitoring",
    "docker"
  ],
  "users": [
    "default",
    {
      "name": "wuoc",
      "gecos": "Wuoc DevOps Student",
      "primary_group": "devops",
      "groups": ["sudo"],
      "shell": "/bin/bash",
      "uid": 1111,
      "system": false,
      "lock_passwd": false,
      "expiredate": "2025-12-31",
      "create_groups": true,
      "hashed_passwd": "$6$mysalt$C2O1HgkslYklbzzdQz....",
      "ssh_authorized_keys": [
        "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFakeBase64HereOnlyAsExample comment"
      ],
      "sudo": "ALL=(ALL) NOPASSWD:ALL"
    },
    {
      "name": "prometheus",
      "gecos": "System monitoring user",
      "primary_group": "monitoring",
      "system": true,
      "no_create_home": true,
      "no_user_group": true,
      "shell": "/usr/sbin/nologin",
      "plain_passwd": "prometheus",
      "lock_passwd": false
    }
  ],
  "files": [
      {
        "path": "/opt/test",
        "type": "file",
        "content": "Original file!",
        "owner": "root:root",
        "mode": "0644",
        "backup": true
      },
      {
        "path": "/opt/test-dir",
        "type": "dir",
        "owner": "root:root",
        "mode": "0755"
      },
      {
        "path": "/opt/test-symlink",
        "type": "link",
        "target": "/opt/test",
        "owner": "root:root",
        "mode": "0755"
      },
      {
        "path": "/opt/test-source",
        "type": "file",
        "source": "https://raw.githubusercontent.com/canonical/cloud-init/main/doc/examples/cloud-config.txt",
        "owner": "root:root",
        "mode": "0755"
      }
  ],
  "service": [
    {
      "name": "nginx",
      "ensure": "running",
      "flags": "--now",
      "timeout": 30
    },
    {
      "name": "apache2",
      "ensure": "stopped",
      "flags": "",
      "timeout": 15
    },
    {
      "name": "mysql",
      "ensure": "restarted",
      "flags": "--quiet",
      "timeout": 45
    }
  ],
  "package": [
    {
      "name": "nginx",
      "ensure": "latest",
      "manager": "apt",
      "options": [
        "--no-install-recommends",
        "--allow-downgrades",
        "-y"
      ],
      "configfiles": "keep",
      "mark_hold": true,
      "source": "http://nginx.org/packages/ubuntu",
      "adminfile": "/tmp/nginx-admin.conf"
    },
    {
      "name": "apache2",
      "ensure": "absent",
      "manager": "apt",
      "options": [
        "--purge",
        "--auto-remove",
        "-y"
      ]
    }
  ],
  "exec": [
    {
      "command": "./install.sh",
      "creates": "/opt/myapp/installed.flag",
      "cwd": "/opt/myapp",
      "environment": [
        "APP_ENV=production",
        "PATH=/usr/local/bin:/usr/bin"
      ],
      "onlyif": "test -d /opt/myapp",
      "timeout": 60,
      "tries": 3,
      "try_sleep": 5,
      "umask": "0022",
      "user": "ubuntu"
    },
    {
      "command": "ls -ls",
      "unless": "test -f /opt/myapp/installed.flag"
    }
  ],
  "ssh_config": {
    "ssh_deletekeys": true,
    "ssh_genkeytypes": [
      "ed25519",
      "rsa"
    ],
    "ssh_quiet_keygen": true,
    "ssh_publish_hostkeys": {
      "enabled": true,
      "blacklist": [
        "rsa"
      ]
    },
    "allow_public_ssh_keys": true,
    "disable_root": true,
    "disable_root_opts": "no-port-forwarding,no-agent-forwarding,no-X11-forwarding,command=\"echo Please login as the user \\\"$USER\\\" rather than \\\"$DISABLE_USER\\\";sleep 5;exit 142\""
  },
  "bootcmd": [
    ["mkdir", "-p", "/run/early-setup"],
    ["sh", "-c", "echo 'bootcmd started at $(date)' >> /var/log/cloud-init.log"],
    ["mount", "/dev/sdb1", "/mnt/data"],
    ["cloud-init-per", "once", "mymkfs", "mkfs", "/dev/vdb"]
  ],
  "device_aliases": {
    "my_alias": "/dev/sdb",
    "swap_disk": "/dev/sdc"
  },
  "disk_setup": {
    "/dev/sdd": {
      "layout": true,
      "overwrite": true,
      "table_type": "mbr"
    },
    "my_alias": {
      "layout": [50, 50],
      "overwrite": true,
      "table_type": "gpt"
    },
    "swap_disk": {
      "layout": [[100, 82]],
      "overwrite": true,
      "table_type": "gpt"
    }
  },
  "fs_setup": [
    { "cmd": "mkfs -t %(filesystem)s -L %(label)s %(device)s", "device": "my_alias.1", "filesystem": "ext4", "label": "fs1" },
    { "device": "my_alias.2", "filesystem": "ext4", "label": "fs2" },
    { "device": "swap_disk.1", "filesystem": "swap", "label": "swap" },
    { "device": "/dev/sdd1", "filesystem": "ext4", "label": "fs3" }
  ],
  "mount_default_fields": [null, null, "auto", "defaults,nofail", "0", "2"],
  "mounts": [
    ["my_alias.1", "/mnt1"],
    ["my_alias.2", "/mnt2"],
    ["swap_disk.1", "none", "swap", "sw", "0", "0"],
    ["/dev/sdd1", "/mnt3"]
  ],
  "swap": {
    "filename": "/swapfile",
    "size": "1G",
    "maxsize": "2G"
  },
  "apt": {
    "preserve_sources_list": true,
    "disable_suites": ["proposed"],
    "primary": [
      {
        "arches": ["default"],
        "uri": "http://archive.ubuntu.com/ubuntu"
      }
    ],
    "security": [
      {
        "arches": ["default"],
        "uri": "http://security.ubuntu.com/ubuntu"
      }
    ],
    "http_proxy": "http://proxy.example.com:3128",
    "https_proxy": "http://proxy.example.com:3128",
    "debconf_selections": {
      "mysql-server": "mysql-server mysql-server/root_password password root123\nmysql-server mysql-server/root_password_again password root123\n"
    },
    "sources": {
      "docker": {
        "source": "deb [arch=amd64] https://download.docker.com/linux/ubuntu $RELEASE stable",
        "keyid": "9DC858229FC7DD38854AE2D88D81803C0EBFCD88",
        "keyserver": "hkp://keyserver.ubuntu.com"
      },
      "kubernetes": {
        "source": "deb https://apt.kubernetes.io/ kubernetes-xenial main",
        "keyid": "BA07F4FB",
        "keyserver": "hkp://keyserver.ubuntu.com"
      }
    },
    "conf": "Acquire::Retries \"3\";\nAcquire::http::Timeout \"10\";\nAPT::Install-Recommends \"false\";\n"
  }
}